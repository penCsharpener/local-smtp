@using Microsoft.AspNetCore.SignalR.Client
@inject NavigationManager Nav
@inject HttpClient httpClient
@implements IAsyncDisposable

<div class="max-dimensions"> 
  <MudGrid Spacing="3">
    <MudItem xs="6">
      <MudTable Items="@messageSummaries" @ref="mudTable" T="MessageSummary" FixedHeader="true" FixedFooter="true" Dense="true" Hover="true" Bordered="false" Striped="true"
                Virtualize="true" Height="calc(100vh - 275px)" Filter="new Func<MessageSummary,bool>(FilterFunc1)" RowStyleFunc="@SelectedRowStyleFunc"
                OnRowClick="@OnSelectedMessageChangedAsync" @bind-SelectedItem="SelectedMessage" RowsPerPage="25" HorizontalScrollbar="true">
        <ToolBarContent>
          <MudButtonGroup Color="Color.Primary" Variant="Variant.Filled" Style="margin-top: 18px;">
            <MudTooltip Text="Delete selected">
              <MudButton Disabled="SelectedMessage == null" StartIcon="@Icons.Material.Filled.Close" OnClick="DeleteSelectedAsync"></MudButton>
            </MudTooltip>
            <MudTooltip Text="Delete all">
              <MudButton StartIcon="@Icons.Material.Filled.Delete" OnClick="DeleteDataAsync"></MudButton>
            </MudTooltip>
            <MudTooltip Text="Refresh messages">
              <MudButton StartIcon="@Icons.Material.Filled.Refresh" OnClick="LoadDataAsync"></MudButton>
            </MudTooltip>
            <MudTooltip Text="Relay">
              <MudButton Disabled="true" StartIcon="@Icons.Material.Filled.FastForward"></MudButton>
            </MudTooltip>
          </MudButtonGroup>
          <MudSpacer />
          <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
        </ToolBarContent>
        <HeaderContent>
          <MudTh><MudTableSortLabel InitialDirection="SortDirection.Descending" SortBy="new Func<MessageSummary, object>(x => x.ReceivedDate)">Received</MudTableSortLabel></MudTh>
          <MudTh><MudTableSortLabel SortBy="new Func<MessageSummary, object>(x => x.From)">From</MudTableSortLabel></MudTh>
          <MudTh><MudTableSortLabel SortBy="new Func<MessageSummary, object>(x => x.To)">To</MudTableSortLabel></MudTh>
          <MudTh><MudTableSortLabel SortBy="new Func<MessageSummary, object>(x => x.Subject)">Subject</MudTableSortLabel></MudTh>
        </HeaderContent>
        <RowTemplate>
          <MudTd Style="@IsMailRead(context.IsUnread)" DataLabel="Received">@context.ReceivedDate</MudTd>
          <MudTd Style="@IsMailRead(context.IsUnread)" DataLabel="From">@context.From</MudTd>
          <MudTd Style="@IsMailRead(context.IsUnread)" DataLabel="To">@context.To</MudTd>
          <MudTd Style="@IsMailRead(context.IsUnread)" DataLabel="Subject">@context.Subject</MudTd>
        </RowTemplate>
        <PagerContent>
          <MudTablePager PageSizeOptions="new int[] {10, 25, 50, 100, 200}" />
        </PagerContent>
      </MudTable>
    </MudItem>
    <MudItem xs="6">
      <MessageDetails Message="@_messageContent" HtmlMessage="@_messageHtml" RawMessage="@_messageRaw"></MessageDetails>
    </MudItem>
  </MudGrid>
</div>
